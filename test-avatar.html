<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar System Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Test styles for avatar system */
        .avatar-test {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: white;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        .avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Color generation similar to Avatar component */
        .bg-red { background-color: #ef4444; }
        .bg-blue { background-color: #3b82f6; }
        .bg-green { background-color: #10b981; }
        .bg-yellow { background-color: #f59e0b; }
        .bg-purple { background-color: #8b5cf6; }
        .bg-pink { background-color: #ec4899; }
        .bg-indigo { background-color: #6366f1; }
        .bg-teal { background-color: #14b8a6; }
        .bg-orange { background-color: #f97316; }
        .bg-cyan { background-color: #06b6d4; }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Avatar System Test</h1>
        
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Available Avatars (Should show images)</h2>
            <div id="available-avatars"></div>
            
            <h2 class="text-xl font-semibold mb-4 mt-8">Fallback Avatars (Should show initials)</h2>
            <div id="fallback-avatars"></div>
            
            <h2 class="text-xl font-semibold mb-4 mt-8">Fuzzy Matching Test</h2>
            <div id="fuzzy-avatars"></div>
        </div>
    </div>

    <script>
        // Available avatars from the generated file
        const availableAvatars = {
            "唐鳳部長": true,
            "葛如鈞委員": true,
            "呂正華署長": true,
            "謝翠娟署長": true,
            "金管會彭金隆主委": true,
            "陳建仁院長": true
        };
        
        // Test speakers that don't have avatars
        const testSpeakers = [
            "測試發言人",
            "John Doe",
            "王小明",
            "Prof. Test Speaker",
            "未知委員"
        ];
        
        // Test fuzzy matching
        const fuzzyTestSpeakers = [
            "唐鳳", // Should match "唐鳳部長"
            "葛如鈞", // Should match "葛如鈞委員"
            "呂正華", // Should match "呂正華署長"
            "彭金隆", // Should match "金管會彭金隆主委"
        ];
        
        // Generate initials function (similar to Avatar component)
        function getInitials(name) {
            if (!name || name.trim() === '') return '?';
            
            const cleanName = name
                .replace(/^(部長|署長|委員|主委|院長|局長|主任|教授|博士|先生|女士|小姐|總統|副總統|市長|縣長|立委|議員|理事長|會長|董事長|執行長|總經理|經理|主管|專員|助理|秘書|顧問|律師|醫師|工程師|研究員|分析師)\s*/, '')
                .replace(/\s*(部長|署長|委員|主委|院長|局長|主任|教授|博士|先生|女士|小姐|總統|副總統|市長|縣長|立委|議員|理事長|會長|董事長|執行長|總經理|經理|主管|專員|助理|秘書|顧問|律師|醫師|工程師|研究員|分析師)$/, '')
                .trim();
            
            // Handle English names
            if (/^[A-Za-z\s]+$/.test(cleanName)) {
                const words = cleanName.split(/\s+/).filter(word => word.length > 0);
                if (words.length >= 2) {
                    return (words[0][0] + words[words.length - 1][0]).toUpperCase();
                } else if (words.length === 1) {
                    return words[0].substring(0, 2).toUpperCase();
                }
            }
            
            const finalName = cleanName || name;
            if (finalName.length >= 2) {
                return finalName.substring(0, 2);
            } else if (finalName.length === 1) {
                return finalName;
            } else {
                return name.substring(0, 1) || '?';
            }
        }
        
        // Generate background color
        function getBackgroundColor(name) {
            const colors = [
                'bg-red', 'bg-blue', 'bg-green', 'bg-yellow', 'bg-purple',
                'bg-pink', 'bg-indigo', 'bg-teal', 'bg-orange', 'bg-cyan'
            ];
            
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                const char = name.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            return colors[Math.abs(hash) % colors.length];
        }
        
        // Create avatar element
        function createAvatar(speakerName, hasImage = false) {
            const div = document.createElement('div');
            div.className = 'avatar-test';
            
            const avatar = document.createElement('div');
            avatar.className = 'avatar';
            
            if (hasImage) {
                const img = document.createElement('img');
                img.src = `/avatars/${encodeURIComponent(speakerName)}.jpg`;
                img.alt = `${speakerName} 的頭像`;
                img.onerror = function() {
                    // Fallback to initials if image fails to load
                    const initials = getInitials(speakerName);
                    const bgColor = getBackgroundColor(speakerName);
                    avatar.className = `avatar ${bgColor}`;
                    avatar.textContent = initials;
                };
                avatar.appendChild(img);
            } else {
                const initials = getInitials(speakerName);
                const bgColor = getBackgroundColor(speakerName);
                avatar.className = `avatar ${bgColor}`;
                avatar.textContent = initials;
            }
            
            const nameSpan = document.createElement('span');
            nameSpan.textContent = speakerName;
            nameSpan.className = 'font-medium text-gray-900';
            
            const initialsSpan = document.createElement('span');
            initialsSpan.textContent = `(${getInitials(speakerName)})`;
            initialsSpan.className = 'text-sm text-gray-500 ml-2';
            
            div.appendChild(avatar);
            div.appendChild(nameSpan);
            div.appendChild(initialsSpan);
            
            return div;
        }
        
        // Render available avatars
        const availableContainer = document.getElementById('available-avatars');
        Object.keys(availableAvatars).forEach(speaker => {
            availableContainer.appendChild(createAvatar(speaker, true));
        });
        
        // Render fallback avatars
        const fallbackContainer = document.getElementById('fallback-avatars');
        testSpeakers.forEach(speaker => {
            fallbackContainer.appendChild(createAvatar(speaker, false));
        });
        
        // Render fuzzy matching test
        const fuzzyContainer = document.getElementById('fuzzy-avatars');
        fuzzyTestSpeakers.forEach(speaker => {
            const div = createAvatar(speaker, false);
            const note = document.createElement('span');
            note.textContent = ' (Should match existing avatar)';
            note.className = 'text-xs text-blue-600';
            div.appendChild(note);
            fuzzyContainer.appendChild(div);
        });
    </script>
</body>
</html>