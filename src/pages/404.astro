---
import Layout from "../layouts/Layout.astro";

const pageTitle = "頁面未找到 - TransPal";
const pageDescription =
  "抱歉，您要找的頁面不存在。請檢查網址是否正確，或返回首頁瀏覽其他內容。";

// Check if this is a speech-related 404 based on URL
const url = Astro.url.pathname;
const isSpeechNotFound = url.startsWith("/speeches/");
const isMessageNotFound =
  url.includes("/speeches/") && url.split("/").length >= 4;

// Extract filename and messageId if available for better error messaging
let filename = "";
let messageId = "";
if (isSpeechNotFound) {
  const pathParts = url.split("/").filter((part) => part);
  if (pathParts.length >= 2) {
    filename = decodeURIComponent(pathParts[1]);
  }
  if (pathParts.length >= 3) {
    messageId = decodeURIComponent(pathParts[2]);
  }
}

// Customize error message based on context
let contextualTitle = "頁面未找到";
let contextualMessage = "抱歉，您要找的頁面不存在。";

if (isMessageNotFound && filename && messageId) {
  contextualTitle = "訊息未找到";
  contextualMessage = `抱歉，在對話「${filename}」中找不到指定的訊息。該訊息可能已被移除或網址有誤。`;
} else if (isSpeechNotFound && filename) {
  contextualTitle = "對話未找到";
  contextualMessage = `抱歉，找不到對話「${filename}」。該對話可能尚未發布或網址有誤。`;
}
---

<Layout
  title={pageTitle}
  description={pageDescription}
  ogTitle="頁面未找到"
  ogDescription={pageDescription}
  ogType="website"
>
  <div class="min-h-[60vh] flex items-center justify-center px-4 sm:px-6">
    <div class="text-center max-w-md mx-auto">
      <!-- 404 Icon -->
      <div class="mb-6 sm:mb-8">
        <div
          class="inline-flex items-center justify-center w-20 h-20 sm:w-24 sm:h-24 bg-gray-100 dark:bg-white/5 rounded-full"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="w-10 h-10 sm:w-12 sm:h-12 text-gray-400 dark:text-white/75"
          >
            <path
              d="M2.586 16.726A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2h6.624a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586z"
            >
            </path>
            <path d="M8 12h8"> </path>
          </svg>
        </div>
      </div>

      <!-- Error Message -->
      <h1
        class="text-3xl sm:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-3 sm:mb-4"
      >
        404
      </h1>

      <h2
        class="text-lg sm:text-xl font-semibold text-gray-700 dark:text-gray-300 mb-3 sm:mb-4"
      >
        {contextualTitle}
      </h2>

      <p
        class="text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-6 sm:mb-8 leading-relaxed"
      >
        {contextualMessage}
        {
          !isSpeechNotFound && (
            <>
              <br />
              可能是網址輸入錯誤，或是該頁面已被移除。
            </>
          )
        }
      </p>

      <!-- Action Buttons -->
      <div
        class="space-y-3 sm:space-y-0 sm:space-x-4 sm:flex sm:justify-center"
      >
        <a
          href="/"
          class="inline-flex items-center justify-center w-full sm:w-auto px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 touch-manipulation"
        >
          <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            ></path>
          </svg>
          返回首頁
        </a>
      </div>
    </div>
  </div>
</Layout>
