---
import DarkModeToggle from "./DarkModeToggle";

// Get current path for navigation logic
const currentPath = Astro.url.pathname;
const isIndex = currentPath === "/";
const isMessage = /\/speeches\/[^/]+\/[^/]+/.test(currentPath);
---

<nav
  class="sticky top-0 z-10 bg-white/80 backdrop-blur-md dark:bg-[#1C1C1C]/80"
  role="navigation"
  aria-label="主要導航"
>
  <div
    class="mx-auto flex max-w-4xl items-center justify-between px-4 py-4 sm:px-6 lg:px-0"
  >
    <div class="flex items-center gap-4">
      {
        !isIndex && (
          <button
            id="back-button"
            class="flex items-center justify-center rounded-full p-2 hover:bg-gray-100 dark:hover:bg-white/10"
            data-is-message={isMessage}
            data-current-path={currentPath}
            aria-label="返回上一頁"
            type="button"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
          </button>
        )
      }
      <a
        href="/"
        class="text-lg font-bold tracking-tight text-gray-900 dark:text-white"
        aria-label="TransPal"
      >
        TransPal
      </a>
    </div>

    <div class="flex items-center gap-4">
      <DarkModeToggle client:load />
    </div>
  </div>
</nav>

<script>
  // Handle back button navigation
  const backButton = document.getElementById("back-button");
  if (backButton) {
    backButton.addEventListener("click", () => {
      const isMessage = backButton.getAttribute("data-is-message") === "true";
      const currentPath = backButton.getAttribute("data-current-path");

      if (isMessage && currentPath) {
        // For message pages, go back to the speech page with anchor
        const pathParts = currentPath.split("/");
        const messageId = pathParts[pathParts.length - 1];
        const speechPath = pathParts.slice(0, -1).join("/");
        window.location.href = `${speechPath}#${messageId}`;
      } else {
        // For other pages, go back to home
        window.location.href = "/";
      }
    });
  }
</script>
