---
import { getSpeeches } from "../utils/speeches";
import LucideArrowRight from "~icons/lucide/arrow-right";

// Get all speeches and sort by date (newest first)
const speeches = await getSpeeches();
const sortedSpeeches = speeches.sort((a, b) => {
  const dateA = new Date(a.date);
  const dateB = new Date(b.date);
  return dateB.getTime() - dateA.getTime();
});

// Format date for display
function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString("zh-TW", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<section aria-labelledby="speeches-heading">
  {
    sortedSpeeches.length === 0 ? (
      <div class="py-12 text-center" role="status" aria-live="polite">
        <div class="text-base text-gray-500 sm:text-lg dark:text-gray-400">
          目前沒有對話
        </div>
      </div>
    ) : (
      <div class="flex flex-col gap-2">
        {sortedSpeeches.map((speech) => (
          <a
            href={`/speeches/${speech.filename}/`}
            class="group relative flex items-center justify-between overflow-hidden rounded-xl bg-gray-50 p-4 transition-colors hover:bg-gray-100 dark:bg-white/5 dark:hover:bg-white/10"
            aria-describedby={`speech-date-${speech.filename}`}
          >
            <div>
              <h3 class="line-clamp-2 text-base font-semibold text-gray-900 dark:text-white">
                {speech.name}
              </h3>
              <time
                id={`speech-date-${speech.filename}`}
                datetime={speech.date}
                class="text-xs text-gray-500 dark:text-white/50"
              >
                {formatDate(speech.date)}
              </time>
            </div>

            <div class="flex size-8 shrink-0 items-center justify-center rounded-full bg-gray-100 text-gray-400 transition-colors group-hover:bg-gray-200 group-hover:text-gray-600 dark:bg-white/5 dark:text-gray-500 dark:group-hover:bg-white/10 dark:group-hover:text-gray-300">
              <LucideArrowRight />
            </div>
          </a>
        ))}
      </div>
    )
  }
</section>
